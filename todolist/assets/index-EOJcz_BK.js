(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function n(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(e){if(e.ep)return;e.ep=!0;const o=n(e);fetch(e.href,o)}})();let a,d;const i="demo2026",y=new Uint8Array([42,133,77,211,99,22,188,45,67,201,55,88,199,12,33,66]);async function l(r){const t=new TextEncoder,n=await crypto.subtle.importKey("raw",t.encode(r),"PBKDF2",!1,["deriveBits","deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:y,iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async function E(r,t){const n=await l(t),s=r.slice(0,12),e=r.slice(12);return new Uint8Array(await crypto.subtle.decrypt({name:"AES-GCM",iv:s},n,e))}async function p(r,t){const n=await l(t),s=crypto.getRandomValues(new Uint8Array(12)),e=await crypto.subtle.encrypt({name:"AES-GCM",iv:s},n,r),o=new Uint8Array(s.length+e.byteLength);return o.set(s),o.set(new Uint8Array(e),12),o}async function f(){if(document.getElementById("master-pass").value.trim()!==i)return alert("Master Password incorrect â†’ dÃ©mo : demo2026");const t=await initSqlJs({locateFile:n=>`https://cdn.jsdelivr.net/npm/sql.js@1.14.0/dist/${n}`});try{const n=await fetch("db.encrypted",{cache:"no-store"});if(n.ok){const s=await n.arrayBuffer(),e=await E(new Uint8Array(s),i);a=new t.Database(e)}else a=new t.Database}catch{a=new t.Database}d=i,u(),document.getElementById("master-modal").style.display="none",document.getElementById("app").style.display="block",new Quill("#task-editor",{theme:"snow"}),A()}function u(){a.exec(`
    CREATE TABLE IF NOT EXISTS users(id INTEGER PRIMARY KEY,username TEXT UNIQUE,password TEXT,salt TEXT);
    CREATE TABLE IF NOT EXISTS tasks(id INTEGER PRIMARY KEY,user_id INTEGER,title TEXT,description TEXT,completed INTEGER DEFAULT 0,created_at DATETIME DEFAULT CURRENT_TIMESTAMP,FOREIGN KEY(user_id)REFERENCES users(id));
  `);try{a.exec("ALTER TABLE users ADD COLUMN salt TEXT")}catch{}}async function m(){if(!a||!d)return;const r=a.export(),t=await p(r,d),n=new Blob([t]),s=URL.createObjectURL(n),e=document.createElement("a");e.href=s,e.download="db.encrypted",e.click(),URL.revokeObjectURL(s),Swal.fire({toast:!0,icon:"success",title:"âœ… db.encrypted sauvegardÃ© !",timer:3e3})}async function T(r,t){const n=new TextEncoder,s=await crypto.subtle.importKey("raw",n.encode(r),"PBKDF2",!1,["deriveBits"]),e=await crypto.subtle.deriveBits({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},s,256);return Array.from(new Uint8Array(e)).map(o=>o.toString(16).padStart(2,"0")).join("")}setInterval(()=>{confirm(`ðŸ”„ Reset auto de la dÃ©mo (toutes les 30 minutes) ?
TOUS les comptes ET toutes les tÃ¢ches seront supprimÃ©s.`)&&w()},1800*1e3);async function w(){a.exec("DELETE FROM users"),a.exec("DELETE FROM tasks"),u();const r=crypto.getRandomValues(new Uint8Array(16)),t=await T("demo123",r),n=Array.from(r).map(s=>s.toString(16).padStart(2,"0")).join("");a.prepare("INSERT INTO users(username,password,salt)VALUES(?,?,?)").run("demo",t,n),a.prepare("SELECT id FROM users WHERE username=?").get("demo").id,loadTasks(),m(),Swal.fire({toast:!0,icon:"success",title:"Reset complet effectuÃ©",timer:4e3})}function A(){const r=document.querySelector(".header-tasks"),t=document.createElement("button");t.className="btn",t.style.background="#007bff",t.style.marginLeft="10px",t.innerHTML="ðŸ“¥ Sauvegarder db.encrypted",t.onclick=m,r.appendChild(t),document.getElementById("register-form").addEventListener("submit",async n=>{}),document.getElementById("login-form").addEventListener("submit",async n=>{}),document.getElementById("add-task-form").addEventListener("submit",n=>{}),document.getElementById("logout").onclick=()=>{}}globalThis.unlockDB=f;
